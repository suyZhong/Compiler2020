# Lab4 实验报告

小组组长 蒲明昱 PB18111733 
小组成员 钟溯飏 PB18111764


## 实验要求

- 了解lightIR设计，阅读文档，了解相关接口的使用
- 阅读cminus-f语义规则与ast.cpp，了解语法树是如何生成的
- 根据相关的语义规则，实现cminus_builder，可以自动生成IR
- 完成类型检查，必要时需要实现转化

## 实验难点

- 如何存取各个变量
- 细心考虑各个地方的类型转换问题
- if/else 中出现return时，对基本块的处理
- 如何正确处理函数调用，函数定义，取值等各个地方的数组（指针）
- 

## 实验设计

请写明为了顺利完成本次实验，加入了哪些亮点设计，并对这些设计进行解释。
可能的阐述方向有:

1. 如何设计全局变量
   - 本次实验对变量的存取基本没有使用全局变量，而是在每次遍历时，创建一个新的scope，使用"@"存放可能的返回值，使用"&"存放返回地址。
   - 使用tmpInt存放可能要用的int值，这个在varDeclaration创建数组中使用，在对num结点遍历后，使用Arraytype创建数组类型时采用更新的tmpInt。
   - 使用assignFlag对assign-stmt做标记，以减少无用的冗余，具体见下。
   - 使用retFlag标记某个stmt里有return-stmt，防止selection-stmt做无用的跳转
2. 遇到的难点以及解决方案
3. 如何降低生成 IR 中的冗余
   1. 降低访问var时的冗余：在本程序设计中，访问var时需要对数据进行load并返回，但在assign表达式里，对左值的操作并不需要load，这里使用assignFlag对其进行标记。同时考虑到在数组赋值时，下标并不是一个左值，这里需要load，于是又采用一个标记对其进行补充。
4. ...


### 实验总结

此次实验有什么收获

### 实验反馈 （可选 不会评分）

对本次实验的建议

### 组间交流 （可选）

本次实验和哪些组（记录组长学号）交流了哪一部分信息
